<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Terminal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
    <style>
        body {
            font-family: 'Orbitron', monospace;
            overflow: hidden;
        }
        .terminal {
            text-shadow: 0 0 5px #c792ea, 0 0 10px #c792ea;
        }
        .prompt {
            color: #ff79c6;
        }
        .command {
            color: #50fa7b;
        }
        .output {
            color: #bd93f9;
        }
        .cursor {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .glow {
            box-shadow: 0 0 15px #bd93f9;
        }
        .quick-command:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 10px #ff79c6;
        }
    </style>
</head>
<body class="bg-black text-white h-screen">
    <div id="vanta-background" class="fixed inset-0"></div>
    
    <div class="relative z-10 w-full h-full p-4">
        <div class="terminal bg-black bg-opacity-80 rounded-lg overflow-hidden border border-purple-500 glow">
            <div class="flex items-center bg-purple-900 bg-opacity-50 p-3 border-b border-purple-500">
                <div class="flex space-x-2 mr-4">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                </div>
                <div class="text-sm text-pink-300">cosmic-terminal</div>
            </div>
            
            <div id="terminal-content" class="p-4 h-[calc(100vh-150px)] overflow-y-auto font-mono text-sm">
                <div class="output mb-2">
                    Welcome to the Cosmic Terminal<br>
                    Type <span class="text-green-400">help</span> for available commands<br><br>
                </div>
                <div class="flex items-center">
                    <span class="prompt mr-2">www-data@nothan:~$</span>
                    <input id="command-input" type="text" class="bg-transparent border-none outline-none flex-1 command" autofocus>
                    <span class="cursor">|</span>
                </div>
            </div>
            
            <div class="bg-purple-900 bg-opacity-30 p-3 border-t border-purple-500 flex flex-wrap gap-2">
                <button onclick="executeQuickCommand('help')" class="quick-command bg-purple-800 hover:bg-purple-700 text-pink-200 px-3 py-1 rounded text-xs transition-all">
                    help
                </button>
                <button onclick="executeQuickCommand('ls')" class="quick-command bg-purple-800 hover:bg-purple-700 text-pink-200 px-3 py-1 rounded text-xs transition-all">
                    ls
                </button>
                <button onclick="executeQuickCommand('pwd')" class="quick-command bg-purple-800 hover:bg-purple-700 text-pink-200 px-3 py-1 rounded text-xs transition-all">
                    pwd
                </button>
                <button onclick="executeQuickCommand('whoami')" class="quick-command bg-purple-800 hover:bg-purple-700 text-pink-200 px-3 py-1 rounded text-xs transition-all">
                    whoami
                </button>
                <button onclick="clearTerminal()" class="quick-command bg-pink-800 hover:bg-pink-700 text-white px-3 py-1 rounded text-xs transition-all ml-auto">
                    Clear
                </button>
                <a href="/user/index.html" class="quick-command bg-blue-800 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs transition-all">
                    Return
                </a>
            </div>
        </div>
    </div>

    <script>
        // Initialize Vanta.js background
        VANTA.NET({
            el: "#vanta-background",
            mouseControls: true,
            touchControls: true,
            gyroControls: false,
            minHeight: 200.00,
            minWidth: 200.00,
            scale: 1.00,
            scaleMobile: 1.00,
            color: 0xbd93f9,
            backgroundColor: 0x0,
            points: 12.00,
            maxDistance: 22.00,
            spacing: 17.00
        });

        const terminalContent = document.getElementById('terminal-content');
        const commandInput = document.getElementById('command-input');
        let commandHistory = [];
        let historyIndex = -1;

        // Focus input on any click in terminal
        terminalContent.addEventListener('click', () => {
            commandInput.focus();
        });

        // Handle command submission
        commandInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const command = commandInput.value.trim();
                if (command) {
                    executeCommand(command);
                    commandHistory.push(command);
                    historyIndex = commandHistory.length;
                }
            } else if (e.key === 'ArrowUp') {
                if (historyIndex > 0) {
                    historyIndex--;
                    commandInput.value = commandHistory[historyIndex];
                }
            } else if (e.key === 'ArrowDown') {
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    commandInput.value = commandHistory[historyIndex];
                } else {
                    historyIndex = commandHistory.length;
                    commandInput.value = '';
                }
            }
        });

        function executeCommand(command) {
            // Display the command
            const commandLine = document.createElement('div');
            commandLine.className = 'flex items-center mb-2';
            commandLine.innerHTML = `
                <span class="prompt mr-2">www-data@nothan:~$</span>
                <span class="command">${command}</span>
            `;
            terminalContent.insertBefore(commandLine, terminalContent.lastElementChild);
            
            // Clear input
            commandInput.value = '';
            
            // Create loading element
            const loading = document.createElement('div');
            loading.className = 'output mb-2';
            loading.textContent = 'Processing...';
            terminalContent.insertBefore(loading, terminalContent.lastElementChild);
            
            // Scroll to bottom
            terminalContent.scrollTop = terminalContent.scrollHeight;
            
            // Send command to backend
            fetch('/user/module/terminal/terminal.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `command=${encodeURIComponent(command)}`
            })
            .then(response => response.json())
            .then(data => {
                // Replace loading with actual output
                loading.innerHTML = data.output.replace(/\n/g, '<br>');
                terminalContent.scrollTop = terminalContent.scrollHeight;
            })
            .catch(error => {
                loading.innerHTML = `Error: ${error.message}`;
                terminalContent.scrollTop = terminalContent.scrollHeight;
            });
        }

        function executeQuickCommand(command) {
            commandInput.value = command;
            commandInput.focus();
        }

        function clearTerminal() {
            // Keep only the last element (input line)
            while (terminalContent.children.length > 1) {
                terminalContent.removeChild(terminalContent.firstChild);
            }
            terminalContent.scrollTop = terminalContent.scrollHeight;
        }

        // Typewriter effect for initial welcome message
        function typeWriter(element, text, speed = 50) {
            let i = 0;
            element.innerHTML = '';
            function typing() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(typing, speed);
                }
            }
            typing();
        }

        // Initialize with some cool effect
        document.addEventListener('DOMContentLoaded', () => {
            const welcome = document.createElement('div');
            welcome.className = 'output mb-2';
            terminalContent.insertBefore(welcome, terminalContent.lastElementChild);
            
            typeWriter(welcome, 'Initializing cosmic terminal...\nEstablishing quantum connection...\nSystem ready.');
        });
    </script>
</body>
</html>
